initPosts();class QuickReplyData{constructor(t,o){this.title=t,this.ts=o}}QuickReplyAutoSaverV2=function(){var t,o,e="qras2",i=new Map,n=0,a=(t,o)=>o instanceof Map?{dataType:"Map",value:Array.from(o.entries())}:o,r=(t,o)=>"object"==typeof o&&null!==o&&"Map"===o.dataType?new Map(o.value):o,s=t=>sprintf("{0}-{1}",fno,t),l=t=>$("#reply"+t+" textarea").val(),p=function(){n>0&&""!=l(n)&&i.set(s(n),(t=>new QuickReplyData(l(t),(new Date).toISOString()))(n));let t=JSON.stringify(i,a);localStorage.setItem(e,t)};this.initQr=function(t){var o=i.get(s(t));$qrTitle=$("#reply"+t+" textarea"),o&&$qrTitle.val(o.title),n=t},this.start=function(o){n=o,t=setInterval(p,2e3)},this.stop=function(o){n==o&&(n=0,window.clearInterval(t))},this.reset=function(t){i.delete(s(t)),p()},o=localStorage.getItem(e),i=null!=o?JSON.parse(o,r):new Map,(()=>{var t=!1;let o=(new Date).getTime();i.forEach((function(e,n){new Date(e.ts).getTime()<o-2592e5&&(i.delete(n),t=!0)})),t&&p()})()};var quickReplyAutoSaverV2=new QuickReplyAutoSaverV2;function adjustForFloatBar(t){return setTimeout((function(){window.scrollBy(0,0-t)}),100),!1}function loadTopic(t,o,e,i){var n=sprintf("/f/ajaxTopic.php?{0}f={1}&t={2}&p={3}","",t,o,e);$.ajax({url:n,type:"GET",success:function(t){$("#t"+o).html(t),initQtip(),"undefined"!=typeof admQtip&&admQtip(),alertTopicUpdate(),i&&i(o)},error:function(t,o,e){toastr.error(t.responseText)}})}function delPost(t){if(!Service.isSignedIn("del"))return!1;if(!confirm("Is it OK to delete it?"))return!1;var o=sprintf("/f/ajaxForum.php?action=delPost&f={0}&p={1}",fno,t);$.ajax({url:o,async:!0,success:function(o){$("li#p"+t).hide(500),$("li#p"+t).next("ul").hide(2e3),toastr.info("Post deleted.")},error:function(t,o,e){toastr.error(e)}});return!1}function initQtip(){$("ul.topic li.post .contentTip").qtip({content:{text:function(t){var o=$(this).closest("li.post").data("pno");return $("#ct"+o).html()},title:" ",button:!0},show:{delay:0},hide:{delay:100,event:"mouseleave",fixed:!0},events:{click:!0,focus:!0},position:{viewport:!0,my:"top center",at:"bottom center",adjust:{method:"shift none",resize:!0}},style:{classes:"qtip-bootstrap"}}),$("ul.topic li.post .piclink").qtip({content:function(t){var o=$(this).attr("piclink");return rtn="<img height=200 src="+o+" >",rtn},show:{delay:0,solo:!0}})}function initPosts(){$(document).on("hide.bs.dropdown","ul.topic li.post .post-reply.dropdown",(function(t){var o=$(this).find("div.dropdown-menu").closest("li.post").data("pno");quickReplyAutoSaverV2&&quickReplyAutoSaverV2.stop(o)})),$(document).on("shown.bs.dropdown","ul.topic li.post .post-reply.dropdown",(function(t){var o=$(this).find("div.dropdown-menu").closest("li.post").data("pno");quickReplyAutoSaverV2&&quickReplyAutoSaverV2.start(o),$("#reply"+o+" textarea").focus()})),$(document).on("show.bs.dropdown","ul.topic li.post .post-reply.dropdown",(function(t){var o=(e=$(this).find("div.dropdown-menu")).closest("li.post").data("pno");if(Service.isSignedIn("reply",o)){var e;populatePostQReplyForm(e=$(this).find("div.dropdown-menu"));var i=$(window).width(),n=$(this)[0].getBoundingClientRect().left,a=i>600?600:i-2,r=i>n+a?0:i-n-a;e.css({left:r+"px",width:a+"px"})}})),$(document).on("show.bs.dropdown","ul.topic li.post .post-cmd.dropdown",(function(t){populatePostCmdMenu($(this).find("div.dropdown-menu"))})),$(document).on("shown.bs.dropdown","ul.topic li.post .post-cmd.dropdown",(function(t){var o=$(this).find("div.dropdown-menu"),e=$(window).width(),i=$(this)[0].getBoundingClientRect().left,n=o.width(),a=e>i+n?0:e-i-n-5;o.css({left:a+"px"})}))}function submitQuickReply(t){var o;quickReplyAutoSaverV2&&quickReplyAutoSaverV2.stop(t);var e=$("#reply"+t);if(e.find("textarea").val().trim()){Service.historyBackOnly=!0,window.history.back(),showWaiting("Sending quick reply...");var i=e.serialize();(o=$.ajax({url:"/api/f/reply",type:"post",data:i})).done((function(t,o,e){var i=JSON.parse(t),n=i.fno,a=i.pno,r=i.tno,s=i.parent,l=i.op,p=i.msg;if(window.location.pathname.endsWith("advancedSearch.php")){$("#reply"+s+" textarea").val("");var c=sprintf("topic.php?f={0}&p={1}",n,a);if(_isIphone)window.location=c;else if(_isIOS){window.open(c,"_blank").focus()}else{window.open(c,"rolia_topic").focus()}}else quickReplyAutoSaverV2&&quickReplyAutoSaverV2.reset(s),loadTopic(n,r,a);"REPLY"==l&&toastr.success("Reply added."),"APPEND_TO_PARENT"==l&&toastr_warning(p),"APPEND_TO_SIBLING"==l&&toastr_warning(p)})),o.fail((function(t,o,e){toastr.error(t.responseText)})),o.always((function(){doneWaiting(),$(".pageDown").show()})),$("li#p"+t+" .post-reply").removeClass("open")}else toastr.error("Please enter text to reply.")}function populatePostQReplyForm(t){var o=t.closest("li.post").data("pno");if(t.html())return;const e=t.closest("ul.topic").find(`li[data-author='${userid}'] .anon`).length;var i=isAnonymousAllowed?`<span class='pull-right btn'>\n\t\t\t<label><input type=checkbox name=anonymous tabindex=-1 ${e>0?"checked":""}>${roliaMsg.anonymous}</label>\n\t\t\t<i data-sp='anon-note' class='a sp fa fa-question-circle-o'></i>\n\t\t</span>`:"",n=`\n\t\t\t<div class='panel-body'>\n\t\t\t\t<form id=reply{%pno}>\n\t\t\t\t\t<input type=hidden name=q value=1 >\n\t\t\t\t\t<input type=hidden name=f value={%fno} >\n\t\t\t\t\t<input type=hidden name=parent value={%pno} >\n\t\t\t\t\t<div class='form-group'>\n\t\t\t\t\t\t<textarea name=title placeholder='${roliaMsg.quick_reply}' autofocus cols=80 rows=1 class='flexHeight form-control' tabindex=1></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type='button' onclick='submitQuickReply({%pno})' class='btn btn-default' tabindex=2 value='Submit'></input>\n\t\t\t\t\t<span onclick=postEditor.reply({%pno}) class='btn btn-default pull-right' >\n\t\t\t\t\t\t<i class='fa fa-arrows-alt'></i> ${roliaMsg.reply_w_media}</span>\n\t\t\t\t\t${i}\t\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t`,a=$("li#p"+o+" .post-title").text();n=(n=(n=n.replace(/\{\%shortTitle\}/g,a)).replace(/\{\%pno\}/g,o)).replace(/\{\%fno\}/g,fno),t.html(n),quickReplyAutoSaverV2&&quickReplyAutoSaverV2.initQr(o)}function populatePostCmdMenu(t){var o=t.closest("ul.topic"),e=o.data("archived"),i=o.data("tno"),n=t.closest("li.post"),a=n.data("pno"),r=n.data("author"),s=n.data("level"),l=o.find("li.post").first().data("author");let p=r==userid?"":"inactive",c=r==userid||l==userid&&"**"==r?"":"inactive";var d="";if(!("undefined"!=typeof isTopicPage&&isTopicPage)&&0==s&&(d+="<li><a href=javascript:FoldThread.fold({%tno}) ><i class='leadingIcon fa fa-eye-slash'></i>"+roliaMsg.fold_topic+"</a>"),$("#p"+a+" span.pno").is(":visible")||(d+="<li><a href=javascript:showPnoSpan({%pno}) >"+roliaMsg.show_pno+"</a>"),"true"==o.attr("data-bookmarked"))d+="<li class='unbookmark'><a href=javascript:FlfService.unbookmark('{%tno}') >"+roliaMsg.undo_bookmark+"</a>";else{var u="<i class='leadingIcon fa fa-bookmark-o'></i>";d+="<li class='bookmark'><a href=javascript:FlfService.bookmark('{%tno}') >"+u+roliaMsg.bookmark+"</a>"}d+="true"==n.attr("data-following")?"<li class='unfollow'><a href=javascript:FlfService.unfollow('{%author}') >"+roliaMsg.unfollow_author+"</a>":"<li class='follow'><a href=javascript:FlfService.follow('{%author}') >"+roliaMsg.follow_author+"</a>",d+="true"==n.attr("data-ignoring")?"<li class='unignore'><a href=javascript:FlfService.unignore('{%author}') >"+roliaMsg.unignore_author+"</a>":"<li class='ignore'><a href=javascript:FlfService.ignore('{%author}') >"+roliaMsg.ignore_author+"</a>";var f=`<li class='${p}'><a class='blog-add link'>${roliaMsg.add_to_blog}</a></li>`,h=e?"":`<li class='${p}'><a href=# onclick='return postEditor.modify(${fno}, {%pno});' >${roliaMsg.edit_post}</a>`,v=e?"":`<li class='${c}'><a class='del-post link'>${roliaMsg.delete_post}</a>`;if(d+=sprintf("<li><a rel=opener target=_blank href=topic.php?f={%fno}&p={%pno}>{0}</a>",roliaMsg.topic),d+=h,d+=sprintf("<li><a rel=opener target=_blank href=reportAbuse.php?f={%fno}&pno={%pno} >{0}</a>",roliaMsg.report_post),d+=v,d+=f,u="<i class='leadingIcon fa fa-share-alt'></i>",d+=sprintf("<li><a href=javascript:FlfService.copyTopicUrl({0},{1}) >{2}{3}</a>",fno,i,u,roliaMsg.share_topic_url),!is_touch_device()||is_touch_device()){const t=location.hostname;d+=`${roliaMsg.share_online}<img width=120 src=https://chart.apis.google.com/chart?chs=120x120&cht=qr&chld=L|0&chl=https://${t}/f/topic.php?qr=1%26v=p%26f=${fno}%26p={%pno} >`}var m=d.replace(/\{\%pno\}/g,a).replace(/\{\%tno\}/g,i).replace(/\{\%fno\}/g,fno).replace(/\{\%author\}/g,r);t.html(m)}function isLF(){return 4096==fno}function showPnoSpan(t){$("#p"+t+" span.pno").show()}function alertTopicUpdate(){var t,o;void 0!==document.hidden?(t="hidden",o="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",o="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",o="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",o="webkitvisibilitychange");var e=document[t];document.addEventListener(o,(function(){e!=document[t]&&(e=document[t])})),e&&alert("Your new reply has been highlighted in the page.")}function setupCustMode(){return window.location="/mem/customizeForum.php?f="+fno,!1}function refreshForumUnit(t,o,e){var i="list.php?f="+t;return e>0?i+="&c="+e:o>0&&(i+="&b="+o),window.location=i,!1}function bannerRotate(t){var o=$("#"+t+" DIV.active");0==o.length&&(o=$("#"+t+" DIV:last"));var e=o.next().length?o.next():$("#"+t+" DIV:first");o.addClass("last-active"),e.css({opacity:0}).addClass("active").animate({opacity:1},1e3,(function(){o.removeClass("active last-active")}))}function initRenderBtns(){const t=`<a class='del-post btn btn-default ml5 ctxBtn'>${roliaMsg.delete_post}</a>`;$(`ul.topic>li[data-author='${userid}']~ul li[data-author='**']>.user-cmd`).after(t);const o=$(`ul.topic[data-cno='7050']>li[data-author='${userid}']~ul li>.user-cmd`);0==fno&&o.after(t)}$(document).on("click",".del-post",(function(t){delPost($(this).closest("li.post").data("pno"))})),$(document).ready((function(){initQtip(),initRenderBtns()}));